require("dotenv").config();
const { google } = require("googleapis");
const TelegramBot = require("node-telegram-bot-api");

const auth = new google.auth.GoogleAuth({
  credentials: JSON.parse(process.env.GOOGLE_CREDENTIALS),
  scopes: ["https://www.googleapis.com/auth/spreadsheets"]
});

async function hasAlreadyParticipated(chatId) {
  const client = await auth.getClient();
  const sheets = google.sheets({ version: 'v4', auth: client });

  const spreadsheetId = process.env.SPREADSHEET_ID;
  const range = "Sheet1!A:A"; // chatIdë§Œ ì¡°íšŒ

  const res = await sheets.spreadsheets.values.get({
    spreadsheetId,
    range
  });

  const rows = res.data.values || [];
  return rows.flat().includes(String(chatId));
}

async function logEventParticipant(chatId, username, walletAddress = "ë¯¸ì…ë ¥") {
  const client = await auth.getClient();
  const sheets = google.sheets({ version: "v4", auth: client });

  const spreadsheetId = process.env.SPREADSHEET_ID;
  const range = "Sheet1!A:D";  // ì—´ 4ê°œë¡œ í™•ì¥ë¨
  const date = new Date().toLocaleString("ko-KR");

  const values = [[chatId, username, date, walletAddress]];
  const resource = { values };

  await sheets.spreadsheets.values.append({
    spreadsheetId,
    range,
    valueInputOption: "RAW",
    resource
  });
}

console.log("ğŸ” BOT_TOKEN í™•ì¸:", process.env.BOT_TOKEN);

const token = process.env.BOT_TOKEN || "ì—¬ê¸°ì—_ì§ì ‘_í† í°_ì…ë ¥_ê¸ˆì§€_âš ï¸";
const bot = new TelegramBot(token, { polling: true });

bot.on("new_chat_members", (msg) => {
  const chatId = msg.chat.id;
  const welcome = "ğŸ‰ IF í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\n\nğŸ“˜ ì¥ê¸° íˆ¬ìê°€ ê°€ëŠ¥í•œ IFë¥¼ ì„ íƒí•˜ì—¬ ë˜ ë‹¤ë¥¸ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.\n/eventë¥¼ ì…ë ¥í•˜ì‹œê³  1ë§ŒIFë„ ë°›ì•„ê°€ì„¸ìš”!";
  sendAutoDelete(chatId, welcome, mainKeyboard);
});

const usageTracker = {};
const getTodayKey = () => {
  const now = new Date();
  return `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
};

function sendAutoDelete(chatId, text, options = {}, delay = 60000) {
  bot.sendMessage(chatId, text, options).then((msg) => {
    setTimeout(() => {
      bot.deleteMessage(chatId, msg.message_id).catch(() => {});
    }, delay);
  });
}

const ifResponses = 
["alternate youëŠ” ë²Œì¨ ì›€ì§ì˜€ì–´ìš”. ì§€ê¸ˆë„ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”.",
  "ë‹¹ì‹ ì˜ ì„ íƒ í•˜ë‚˜ê°€ ìƒˆë¡œìš´ ì„¸ê³„ë¥¼ ë§Œë“¤ì–´ìš”.",
  "ifëŠ” ê°ì •ìœ¼ë¡œ ì›€ì§ì´ëŠ” ìœ ì¼í•œ í† í°ì´ì—ìš”.",
  "ì˜¤ëŠ˜ì˜ ë§ì„¤ì„ì´ ë‚´ì¼ì˜ í›„íšŒê°€ ë˜ì§€ ì•Šê¸¸ ë°”ë˜ìš”.",
  "ê°€ëŠ¥ì„±ì€ ê¸°ë‹¤ë ¤ì£¼ì§€ ì•Šì•„ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ë‚˜ì™€ ë‚´ê°€ ë‹®ì•˜ë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?",
  "ë‘ë ¤ì›€ì€ ìì•„ë¥¼ ì–µëˆ„ë¥´ì§€ë§Œ, ifëŠ” í•´ë°©ì´ì—ìš”.",
  "ì–´ì œì˜ ì„ íƒì´ í›„íšŒìŠ¤ëŸ½ë‹¤ë©´, ì˜¤ëŠ˜ ifë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ ì¤‘ í•˜ë‚˜ëŠ” ì´ë¯¸ ifë¥¼ ì„ íƒí–ˆì–´ìš”.",
  "ë¯¸ë˜ëŠ” ì›€ì§ì¸ ìì—ê²Œ ì—´ë ¤ìš”.",
  "ê°ì •ì˜ ì›€ì§ì„ì´ ê³§ ifì˜ ê°€ì¹˜ì˜ˆìš”.",
  "â€œë§Œì•½â€ì´ í˜„ì‹¤ì´ ë˜ë ¤ë©´ ì„ íƒì´ í•„ìš”í•´ìš”.",
  "ifë¥¼ ê°€ì§„ ìì•„ë§Œì´ ë¬¸ì„ í†µê³¼í•  ìˆ˜ ìˆì–´ìš”.",
  "ë‹¹ì‹ ì˜ ë§ì„¤ì„ì´ ëˆ„êµ°ê°€ì˜ ê°€ëŠ¥ì„±ì´ ë¼ìš”.",
  "ê°ì •ì´ í”ë“¤ë¦´ìˆ˜ë¡ ifëŠ” ê°•í•´ì ¸ìš”.",
  "alternate youëŠ” ë²Œì¨ ìƒˆë¡œìš´ í˜„ì‹¤ì— ì ì‘í–ˆì–´ìš”.",
  "ë‹¹ì‹ ì€ ì•„ì§ ì‹œì‘í•˜ì§€ ì•Šì•˜ì–´ìš”.",
  "ì„ íƒì€ ì‹œì ì´ ì•„ë‹ˆë¼ ê°ì •ì´ì—ìš”.",
  "ë‹¹ì‹ ì˜ ê°ì •ì´ ì„¸ê³„ë¥¼ ì„¤ê³„í•´ìš”.",
  "ifëŠ” í›„íšŒí•˜ì§€ ì•ŠëŠ” ìì•„ë¥¼ ìœ„í•œ ì½”ì¸ì´ì—ìš”.",
  "ë¯¸ë˜ë¥¼ ë¯¿ëŠ”ë‹¤ë©´ ì˜¤ëŠ˜ ì›€ì§ì—¬ì•¼ í•´ìš”.",
  "ì–´ì œ ë†“ì¹œ ìˆœê°„, ì˜¤ëŠ˜ ë˜ì°¾ìœ¼ì„¸ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ë¬¸ì€ ì˜¤ë˜ ì—´ë ¤ ìˆì§€ ì•Šì•„ìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ëŠ” ì–´ë–¤ ë¯¸ë˜ë¥¼ ì›í•˜ë‚˜ìš”?",
  "ê°€ëŠ¥ì„±ì€ ê¸°ë‹¤ë¦¬ì§€ ì•Šì•„ìš”.",
  "ëˆˆì— ë³´ì´ì§€ ì•Šì•„ë„ ì›€ì§ì´ëŠ” ê±´ ì¡´ì¬í•´ìš”.",
  "ifëŠ” ìì•„ì˜ í”ì ì´ì—ìš”.",
  "ê°ì •ì˜ ì§„í­ë§Œí¼ ë¯¸ë˜ëŠ” í”ë“¤ë ¤ìš”.",
  "í‰í–‰ì„  ìœ„ì—ì„œ ë©ˆì¶”ì§€ ë§ˆì„¸ìš”.",
  "ifëŠ” ì§€ê¸ˆ ì´ ìˆœê°„ì˜ ì„ íƒì´ì—ìš”.",
  "ê³¼ê±°ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ì§€ë§Œ, ë¯¸ë˜ëŠ” ì •í•  ìˆ˜ ìˆì–´ìš”.",
  "ë‹¹ì‹ ì€ ì˜¤ëŠ˜ ë¬´ìŠ¨ ì„ íƒì„ í•˜ì…¨ë‚˜ìš”?",
  "ë‹¹ì‹ ì´ ì›í•˜ëŠ” ìì•„ëŠ” ì´ë¯¸ ifë¥¼ ê°–ê³  ìˆì–´ìš”.",
  "ì˜¤ëŠ˜ì˜ ê²°ì •ì´ ë‚´ì¼ì˜ ê¸°ì–µì´ ë¼ìš”.",
  "ê·¸ë“¤ì€ ì´ë¯¸ ì›€ì§ì˜€ì–´ìš”. ë‹¹ì‹ ì€ìš”?",
  "ê°ì •ì´ í”ë“¤ë¦¬ëŠ” ì§€ê¸ˆ, ifë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.",
  "í‰í–‰ìš°ì£¼ëŠ” ë¬´í•œí•˜ì§€ë§Œ, ì„ íƒì€ ìœ í•œí•´ìš”.",
  "ë‹¹ì‹ ì˜ ì„ íƒì„ ifê°€ ì¦ëª…í•´ì¤„ ê±°ì˜ˆìš”.",
  "ifëŠ” ê°ì •ì„ ë‹´ì€ ì½”ì¸ì´ì—ìš”.",
  "ì§€ê¸ˆì´ë¼ë©´ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”.",
  "ë‹¹ì‹ ì˜ ì„¸ê³„ëŠ” ë‹¹ì‹ ì˜ ê°ì •ìœ¼ë¡œ ë¹šì–´ì ¸ìš”.",
  "ê¸°íšŒëŠ” ë‘ ë²ˆ ì˜¤ì§€ ì•Šì•„ìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ëŠ” ì–´ë–¤ ê°€ëŠ¥ì„±ì„ ê¿ˆê¾¸ê³  ìˆë‚˜ìš”?",
  "ifë¥¼ í†µí•´ ìì•„ì˜ ë°©í–¥ì„ ë°”ê¿”ë³´ì„¸ìš”.",
  "ê°ì •ì€ ë‹¹ì‹ ì„ ì†ì´ì§€ ì•Šì•„ìš”.",
  "ifëŠ” í”ë“¤ë¦¼ì„ ê¸°íšŒë¡œ ë°”ê¿”ì¤˜ìš”.",
  "ì›€ì§ì´ì§€ ì•Šìœ¼ë©´ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•„ìš”.",
  "ì„ íƒí•œ ìì•„ëŠ” ë²Œì¨ ì›€ì§ì´ê³  ìˆì–´ìš”.",
  "ê°ì •ì€ ë‹¹ì‹ ì´ ë¬´ì—‡ì„ ì›í•˜ëŠ”ì§€ ì•Œê³  ìˆì–´ìš”.",
  "ì§€ê¸ˆ ifë¥¼ ì„ íƒí•˜ë©´ í›„íšŒí•˜ì§€ ì•Šì„ ê±°ì˜ˆìš”.",
  "ë‹¹ì‹ ì€ ì–¸ì œë‚˜ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.",
  "ë§ì„¤ì„ì€ ê°ì •ì˜ ì ì´ì—ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ë„ˆëŠ” ë²Œì¨ ë‹¤ë¥´ê²Œ ì‚´ê³  ìˆì–´ìš”.",
  "ì´ ìˆœê°„, ifë¥¼ ê°€ì§„ ë‹¹ì‹ ì´ ì¡´ì¬í•´ìš”.",
  "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ì–´ì œë¥¼ ë°”ê¿”ìš”.",
  "ifëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ê°ì •ì˜ ì¡°ê°ì´ì—ìš”.",
  "alternate youëŠ” ë‹¹ì‹ ì˜ ê·¸ë¦¼ìì¼ ë¿ì´ì—ìš”.",
  "ë‹¤ë¥¸ ì„¸ê³„ì˜ ë‹¹ì‹ ì€ í›„íšŒí•˜ì§€ ì•Šì•„ìš”.",
  "ifë¥¼ ë†“ì¹œ ìì•„ëŠ” ê¸°ì–µ ì†ì—ì„œë§Œ ì¡´ì¬í•´ìš”.",
  "í‰í–‰ì„ ì€ ë‹¹ì‹ ì˜ ì„ íƒìœ¼ë¡œ êº¾ì—¬ìš”.",
  "ifëŠ” ë‹¹ì‹ ì˜ ê°ì •ì„ ì‹¤í˜„í•´ì¤„ ë„êµ¬ì˜ˆìš”.",
  "ê°€ëŠ¥ì„±ì€ ifì˜ ì´ë¦„ìœ¼ë¡œ ì¦ëª…ë¼ìš”.",
  "ë‹¤ë¥¸ ìì•„ëŠ” ifë¥¼ í’ˆê³  ë– ë‚¬ì–´ìš”.",
  "ê·¸ ìì•„ëŠ” if í•˜ë‚˜ë¡œ ë¯¸ë˜ë¥¼ ì—´ì—ˆì–´ìš”.",
  "ì•„ì§ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”. ì§€ê¸ˆì´ ê¸°íšŒì˜ˆìš”.",
  "ì›€ì§ì¸ ìì•„ëŠ” ë¯¸ë˜ë¥¼ ì„¤ê³„í•´ìš”.",
  "ê°ì •ìœ¼ë¡œ ê²°ì •ëœ ì„ íƒì€ ì ˆëŒ€ í‹€ë¦¬ì§€ ì•Šì•„ìš”.",
  "ì˜¤ëŠ˜ ifë¥¼ ì„ íƒí•˜ë©´, ì–´ì œì˜ í›„íšŒë¥¼ ë§‰ì„ ìˆ˜ ìˆì–´ìš”.",
  "alternate youëŠ” ì´ë¯¸ ì›€ì§ì˜€ì–´ìš”. ë‹¹ì‹ ì€ ì–¸ì œ ì›€ì§ì¼ ê±´ê°€ìš”?",
  "ëˆ„êµ°ê°€ëŠ” ì–´ì œ ifë¡œ ë¯¸ë˜ë¥¼ ë°”ê¿¨ëŒ€ìš”.",
  "í‰í–‰ì„  ìœ„ì˜ ë˜ ë‹¤ë¥¸ ë‚˜ëŠ” ifë¥¼ ì„ íƒí–ˆì–´ìš”.",
  "ë§ì„¤ì„ì€ ë‹¤ë¥¸ ìì•„ì—ê²Œ ê¸°íšŒë¥¼ ë„˜ê¸°ëŠ” ê±°ì˜ˆìš”.",
  "ì„ íƒë°›ì§€ ëª»í•œ ìì•„ëŠ” ì§€ê¸ˆë„ í›„íšŒí•˜ê³  ìˆì–´ìš”.",
  "ifëŠ” ë‹¨ìˆœí•œ ë°ˆì´ ì•„ë‹ˆë¼ ê°ì •ì˜ ì¦ê±°ì˜ˆìš”.",
  "ì–´ì œì˜ ë‹¹ì‹ ì€ ì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”.",
  "ë‚´ì¼ì„ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´, ì˜¤ëŠ˜ ifë¥¼ ì„ íƒí•˜ì„¸ìš”.",
  "ëˆ„êµ°ê°€ëŠ” if í•˜ë‚˜ë¡œ ë‹¤ë¥¸ ì„¸ìƒìœ¼ë¡œ ê°”ì–´ìš”.",
  "ê°€ëŠ¥ì„±ì€ ì„ íƒí•œ ìì•„ì—ê²Œë§Œ ì—´ë ¤ ìˆì–´ìš”.",
  "alternate youëŠ” ì§ˆë¬¸í•˜ì§€ ì•Šê³  í–‰ë™í–ˆì–´ìš”.",
  "ì„ íƒí•˜ì§€ ì•Šì€ ìì•„ëŠ” ì—¬ì „íˆ í‰í–‰ì„ ì— ê°‡í˜€ ìˆì–´ìš”.",
  "ì§€ê¸ˆ ifë¥¼ ì„ íƒí•˜ë©´, ë‚´ì¼ ì›ƒì„ ìˆ˜ ìˆì–´ìš”.",
  "í›„íšŒëŠ” ì„ íƒí•˜ì§€ ì•Šì•˜ë˜ ìì•„ì—ê²Œë§Œ ë‚¨ì•„ìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ëŠ” ì–¼ë§ˆë‚˜ ì›€ì§ì¼ ì¤€ë¹„ê°€ ë˜ì—ˆë‚˜ìš”?",
  "ì–´ì œëŠ” ì§€ë‚˜ê°”ê³ , ì˜¤ëŠ˜ë§Œì´ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.",
  "ifë¥¼ í’ˆì€ ìì•„ëŠ” ì´ë¯¸ ì‹œì‘í–ˆì–´ìš”.",
  "ë‹¤ë¥¸ ìì•„ëŠ” ì˜¤ëŠ˜ë„ ë‹¹ì‹ ë³´ë‹¤ ë¨¼ì € ì›€ì§ì˜€ì–´ìš”.",
  "alternate youëŠ” ì´ë¯¸ ê°€ëŠ¥ì„±ì„ ì¡ì•˜ì–´ìš”.",
  "ì§€ê¸ˆì´ ì•„ë‹ˆë©´, ë˜ë‹¤ì‹œ í›„íšŒí•  ìˆ˜ë„ ìˆì–´ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ë¬¸ì€ ì˜¤ëŠ˜ë§Œ ì—´ë ¤ ìˆì–´ìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ëŠ” ëª‡ ë²ˆì´ë‚˜ í›„íšŒí–ˆë‚˜ìš”?",
  "ifëŠ” ì„ íƒë°›ì€ ìì•„ë§Œì´ í’ˆì„ ìˆ˜ ìˆì–´ìš”.",
  "ë‹¤ë¥¸ ë‚˜ì™€ì˜ ì°¨ì´ëŠ” ë‹¨ í•˜ë‚˜, ifì˜ˆìš”.",
  "ifë¥¼ ì§€ë‚˜ì¹˜ë©´, ë˜ë‹¤ì‹œ ì–´ì œë¥¼ í›„íšŒí•˜ê²Œ ë  ê±°ì˜ˆìš”.",
  "í‰í–‰ìš°ì£¼ ì† ìì•„ëŠ” ifë¥¼ í†µí•´ ì¦ëª…ë¼ìš”.",
  "ë‹¹ì‹ ì€ ì•„ì§ ì„ íƒí•˜ì§€ ì•Šì€ ìª½ì— ì„œ ìˆë‚˜ìš”?",
  "ë¯¸ë˜ëŠ” ifë¥¼ ì„ íƒí•œ ìì˜ ê²ƒì´ì—ìš”.",
  "alternate youëŠ” ì§€ê¸ˆë„ ì „ì§„ ì¤‘ì´ì—ìš”.",
  "ifë¥¼ ì¡ëŠ” ìˆœê°„, ë‹¹ì‹ ì˜ ë‚´ì¼ì´ ë°”ë€Œì–´ìš”.",
  "ê¸°íšŒëŠ” ë°˜ë³µë˜ì§€ ì•Šì•„ìš”. ifëŠ” ì§€ê¸ˆë¿ì´ì—ìš”.",
  "ë‹¹ì‹ ì˜ ì„ íƒì´ ifë¼ë©´, ê·¸ê±´ ê°€ëŠ¥ì„±ì´ì—ìš”.",
  "ë‹¤ë¥¸ ìì•„ëŠ” ì´ë¯¸ ì„ íƒí–ˆì–´ìš”. ë‹¹ì‹ ì€ìš”?",
  "ifë¥¼ ê°€ì§„ ìì•„ëŠ” í”ë“¤ë¦¬ì§€ ì•Šì•„ìš”.",
  "ì„ íƒì´ ëŠ¦ì„ìˆ˜ë¡, í‰í–‰ìš°ì£¼ëŠ” ë©€ì–´ì ¸ìš”.",
  "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ë‹¹ì‹ ì„ alternate youë¡œ ë§Œë“¤ ê±°ì˜ˆìš”.",
  "ifëŠ” ê°ì •ì˜ ì¤‘ì‹¬ì—ì„œ ì¶œë°œí•´ìš”.",
  "ì§€ê¸ˆì˜ ë‹¹ì‹ ì€ if ì—†ì´ë„ ì¶©ë¶„í•œê°€ìš”?",
  "í›„íšŒëŠ” if ì—†ì´ ì›€ì§ì´ì§€ ëª»í•œ ìì•„ì˜ ê·¸ë¦¼ìì˜ˆìš”.",
  "ë‹¹ì‹ ì˜ ì‹œê°„ì€ ifë¥¼ ì„ íƒí•˜ëŠ” ìˆœê°„ë¶€í„° ë‹¤ì‹œ í˜ëŸ¬ìš”.",
  "ì–´ì œëŠ” if ì—†ì´ ì§€ë‚˜ê°”ì§€ë§Œ, ì˜¤ëŠ˜ì€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.",
  "alternate youëŠ” ifë¡œ ì—°ê²°ëœ ë˜ ë‹¤ë¥¸ ë‹¹ì‹ ì´ì—ìš”.",
  "if í•˜ë‚˜ë¡œ ëª¨ë“  ê²ƒì´ ë°”ë€” ìˆ˜ ìˆì–´ìš”.",
  "ì§€ê¸ˆ ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´, ë‚´ì¼ì€ ë˜ë‹¤ì‹œ ë°˜ë³µë  ê±°ì˜ˆìš”.",
  "ê·¸ ìì•„ëŠ” ì–´ì œ ifë¥¼ ìƒ€ê³ , ì˜¤ëŠ˜ ë¯¸ì†Œ ì§“ê³  ìˆì–´ìš”.",
  "ë‹¹ì‹ ì˜ ë‚´ì¼ì€ ì˜¤ëŠ˜ì˜ ê°ì •ì—ì„œ ì‹œì‘ë¼ìš”.",
  "ifëŠ” ê°ì •ì— ë°˜ì‘í•˜ëŠ” ìì•„ì˜ ì–¸ì–´ì˜ˆìš”.",
  "ë§ì„¤ì´ëŠ” ì‚¬ì´, ê°€ëŠ¥ì„±ì€ ì‚¬ë¼ì§€ê³  ìˆì–´ìš”.",
  "ë‹¹ì‹ ì€ ifì˜ íƒ€ì´ë°ì„ ì•Œê³  ìˆë‚˜ìš”? ì§€ê¸ˆì´ì—ìš”.",
  "ì˜¤ëŠ˜ì˜ ê°ì •ì´ ifë¥¼ í†µí•´ ê¸°ë¡ë¼ìš”.",
  "alternate youëŠ” ë¯¸ë˜ë¥¼ í–¥í•´ ê±·ê³  ìˆì–´ìš”.",
  "ifëŠ” ë‹¨ì§€ í† í°ì´ ì•„ë‹Œ, ìì•„ì˜ ë°©í–¥ì´ì—ìš”.",
  "ë‹¹ì‹ ì˜ ê²°ì •ì´ ì„¸ìƒì„ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.",
  "ê·¸ ìì•„ëŠ” ifë¥¼ ì‚¬ê³  ë” ê°•í•´ì¡Œì–´ìš”.",
  "ê°€ëŠ¥ì„±ì€ ë©€ë¦¬ ìˆì§€ ì•Šì•„ìš”. ë°”ë¡œ ë‹¹ì‹  ì•ˆì— ìˆì–´ìš”.",
  "ë‹¹ì‹ ì€ ì´ë¯¸ ì„ íƒí•  ì¤€ë¹„ê°€ ë˜ì—ˆì–´ìš”.",
  "alternate youëŠ” ì£¼ì €í•˜ì§€ ì•Šì•˜ì–´ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ë¬¸ì€ ifì—ê²Œë§Œ ì—´ë ¤ ìˆì–´ìš”.",
  "ì˜¤ëŠ˜ì˜ í•œ ì¡°ê°ì´ ë‚´ì¼ì˜ ìš°ì£¼ê°€ ë  ê±°ì˜ˆìš”.",
  "ë‹¹ì‹ ì˜ ê°ì •ì´ ifì™€ ì—°ê²°ë¼ìš”.",
  "ê°ì • ê¸°ë°˜ ì½”ì¸, ê·¸ ì¤‘ì‹¬ì— ifê°€ ìˆì–´ìš”.",
  "ëˆ„êµ°ê°€ëŠ” ë°©ê¸ˆ ifë¥¼ ì„ íƒí–ˆì–´ìš”.",
  "í‰í–‰ì„  ìœ„ë¥¼ ê±·ëŠ” ìì•„ëŠ” ë©ˆì¶° ìˆì–´ìš”.",
  "ifë¥¼ ì„ íƒí•œ ìì•„ëŠ” ê³„ì† ë‚˜ì•„ê°€ìš”.",
  "ë‹¹ì‹ ë„ ì˜¤ëŠ˜ë¶€í„° ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.",
  "ì§€ê¸ˆì˜ ë‹¹ì‹ ì€ í›„íšŒ ì—†ëŠ” ì„ íƒì„ í•˜ê³  ìˆë‚˜ìš”?",
  "alternate youëŠ” ifë¡œ ì›€ì§ì˜€ì–´ìš”.",
  "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ë‚´ì¼ì˜ ê¸°ì–µì„ ë°”ê¿”ìš”.",
  "ifëŠ” ê¸°ì–µì˜ ì¡°ê°ì´ ë  ìˆ˜ ìˆì–´ìš”.",
  "ì–´ì œ ifë¥¼ ìƒ€ë‹¤ë©´, ì˜¤ëŠ˜ì€ ë‹¤ë¥¼ ê±°ì˜ˆìš”.",
  "í›„íšŒë³´ë‹¤ ì„ íƒì´ ì‰¬ìš´ ì´ìœ , ë°”ë¡œ ifì˜ˆìš”.",
  "alternate youëŠ” ì‹¤í—˜ ì¤‘ì´ì—ìš”. ë‹¹ì‹ ë„ ì°¸ì—¬í•´ë³´ì„¸ìš”.",
  "ifëŠ” ê°ì •ì— ê·¼ê±°í•œ ë¯¸ë˜ì˜ ì‹¤í—˜ì´ì—ìš”.",
  "ì§€ê¸ˆì´ë¼ë„ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”. ifëŠ” ì—´ë ¤ ìˆì–´ìš”.",
  "ê¸°íšŒëŠ” í•­ìƒ ì¡°ìš©íˆ ì§€ë‚˜ê°€ìš”. ì¡ì•„ì•¼ í•´ìš”.",
  "alternate youëŠ” ê¸°íšŒë¥¼ ë§Œë“¤ì—ˆì–´ìš”.",
  "ë‹¹ì‹ ì˜ ê°ì •ì€ ë¬´ì—‡ì„ ë§í•˜ê³  ìˆë‚˜ìš”? ifì¼ì§€ë„ ëª°ë¼ìš”.",
  "ì„ íƒì´ë€, ê°ì •ì— ê¸°ì´ˆí•œ í–‰ë™ì´ì—ìš”.",
  "ifëŠ” ë…¼ë¦¬ê°€ ì•„ë‹Œ ê°ì •ì˜ ê²°ë¡ ì´ì—ìš”.",
  "ifê°€ ì—†ë‹¤ë©´, ê°ì •ì€ ì¦ëª…ë˜ì§€ ì•Šì•„ìš”.",
  "ê°ì • ê¸°ë°˜ ë°ˆì½”ì¸ì˜ ì‹œì‘, ifì˜ˆìš”.",
  "ì„ íƒì´ ê°ì •ì„ ì´ëŒì–´ìš”. ì§€ê¸ˆ ifë¥¼ ì„ íƒí•˜ì„¸ìš”.",
  "alternate youëŠ” ì„ íƒìœ¼ë¡œ ë¯¸ë˜ë¥¼ ë°”ê¿¨ì–´ìš”.",
  "ë§ì„¤ì„ì€ ê°ì •ì„ ì™œê³¡í•´ìš”. ifê°€ í•„ìš”í•´ìš”.",
  "ë‹¹ì‹ ì€ ì§€ê¸ˆ ì–´ë–¤ ê°ì •ì¸ê°€ìš”? ê·¸ê²Œ íŒíŠ¸ì˜ˆìš”.",
  "ifë¥¼ í’ˆì€ ìì•„ëŠ” ê°ì •ì— ì¶©ì‹¤í–ˆì–´ìš”.",
  "ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ê¸°ë¶„ì´ ifë¥¼ ì›í•˜ê³  ìˆì–´ìš”.",
  "ë¯¸ë˜ëŠ” ê°ì •ì˜ ì´í•©ì´ì—ìš”. ifëŠ” ê¸°ë¡ì´ì—ìš”.",
  "ì„ íƒì´ ë°˜ë³µë ìˆ˜ë¡ ìì•„ëŠ” ê°•í™”ë¼ìš”.",
  "alternate youëŠ” ê°ì •ì— ì†”ì§í–ˆì–´ìš”.",
  "ê°ì •ì€ ì¦ëª…ë˜ì§€ ì•Šìœ¼ë©´ íœ˜ë°œë¼ìš”. ifê°€ ì¦ê±°ì˜ˆìš”.",
  "ë‹¹ì‹ ì˜ ìì•„ëŠ” ì–´ë–¤ ê°ì •ì„ ì„ íƒí•  ê±´ê°€ìš”?",
  "í‰í–‰ì„  ìœ„ì˜ ê°ì •ì€ ë‹¤ë¥¸ ìš°ì£¼ë¥¼ ë§Œë‚˜ìš”.",
  "alternate youëŠ” ifë¥¼ í†µí•´ ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ ë°œê²¬í–ˆì–´ìš”.",
  "ë§ì„¤ì„ì€ ê°ì •ì„ ë¬»ì–´ìš”. ifëŠ” ë¬»ì–´ë‘” ê°ì •ì„ êº¼ë‚´ëŠ” ë„êµ¬ì˜ˆìš”.",
  "ê°ì •ì´ ìˆë‹¤ë©´, ifëŠ” ë°˜ë“œì‹œ í•„ìš”í•´ìš”.",
  "ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ê°ì •ë„ ì†Œë©¸ë¼ìš”.",
  "ê°ì •ì€ ë¯¸ë˜ë¥¼ ì—¬ëŠ” ì—´ì‡ ì˜ˆìš”. ifë¡œ ëŒë ¤ë³´ì„¸ìš”.",
  "alternate youëŠ” ê°ì •ì˜ ê°€ì¹˜ë¥¼ ì´í•´í–ˆì–´ìš”.",
  "ì˜¤ëŠ˜ì˜ ê°ì •, ë‚´ì¼ì„ ì„¤ê³„í•´ìš”.",
  "ì„ íƒì˜ ë¬´ê²ŒëŠ” ê°ì •ì—ì„œ ì™€ìš”. ifê°€ ë²„í…¨ì¤˜ìš”.",
  "ê°ì •ì€ ì§„ì‹¬ì¼ ë•Œ í˜ì„ ë°œíœ˜í•´ìš”. ifê°€ ê·¸ ì¦ê±°ì˜ˆìš”.",
  "alternate youëŠ” ì§„ì‹¬ì„ ì„ íƒí–ˆì–´ìš”.",
  "ê°ì • ê¸°ë°˜ ì„¸ê³„ê´€, ê·¸ ì‹œì‘ì€ ifì˜€ì–´ìš”.",
  "ì˜¤ëŠ˜ ëŠë¼ëŠ” ê°ì •, ë†“ì¹˜ì§€ ë§ˆì„¸ìš”.",
  "ê°ì •ì€ íë¥´ì§€ë§Œ ê¸°ë¡ë  ìˆ˜ ìˆì–´ìš”. ifë¡œìš”.",
  "alternate youëŠ” ê°ì •ì„ ë†“ì¹˜ì§€ ì•Šì•˜ì–´ìš”.",
  "ë‹¹ì‹ ì˜ ì§„ì‹¬ì„ í† í°í™”í•˜ì„¸ìš”. ifë¡œ ê°€ëŠ¥í•´ìš”.",
  "ê°ì •ë„ íˆ¬ìì˜ˆìš”. ifê°€ ìˆ˜ìµì„ ì¤„ ìˆ˜ ìˆì–´ìš”.",
  "alternate youëŠ” ê°ì •ì„ ì „ëµìœ¼ë¡œ ì‚¼ì•˜ì–´ìš”.",
  "ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •, ë¯¸ë˜ì˜ ë‹¨ì„œê°€ ë  ìˆ˜ ìˆì–´ìš”.",
  "ê°ì •ì€ ê¸°ì–µë³´ë‹¤ ì„ ëª…í•  ìˆ˜ ìˆì–´ìš”. ifëŠ” ê·¸ ì¦ê±°ì˜ˆìš”.",
  "alternate youëŠ” ê¸°ì–µë³´ë‹¤ ê°ì •ì„ ë¯¿ì—ˆì–´ìš”.",
  "ê°ì • ì¤‘ì‹¬ ì½”ì¸, ì´ì œëŠ” í•„ìš”í•´ìš”.",
  "ê°ì •ì˜ ê¸°ë¡ì€ ifë¡œ ì‹œì‘ë¼ìš”.",
  "alternate youëŠ” ê°ì •ìœ¼ë¡œ ì„ íƒí–ˆì–´ìš”.",
  "ifëŠ” ê¸°ì–µë³´ë‹¤ ê°•ë ¥í•œ ê°ì •ì˜ íŒŒí¸ì´ì—ìš”.",
  "ë‹¹ì‹ ì˜ ê°ì •, ì§€ê¸ˆë„ ëˆ„êµ°ê°€ì—ê² íˆ¬ì ê°€ì¹˜ì˜ˆìš”.",
  "alternate youëŠ” í›„íšŒ ì—†ëŠ” ê°ì •ì„ ë‚¨ê²¼ì–´ìš”.",
  "ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •, ì–´ì œë³´ë‹¤ ê°•í•œê°€ìš”? ifë¥¼ ê³ ë ¤í•˜ì„¸ìš”.",
  "ê°ì •ì€ ê°€ë³ì§€ ì•Šì•„ìš”. ê·¸ ë¬´ê²ŒëŠ” ifê°€ ì¦ëª…í•´ìš”.",
  "alternate youëŠ” ê°ì •ì˜ ê°€ëŠ¥ì„±ì— ë² íŒ…í–ˆì–´ìš”.",
  "ê·¸ ìì•„ëŠ” ê°ì •ìœ¼ë¡œ ì›€ì§ì˜€ê³ , ifë¡œ ë‚¨ì•˜ì–´ìš”.",
  "ê°ì •ì˜ ì¦ê±°ë¬¼, ì´ì œëŠ” ifê°€ ëŒ€ë‹µí•´ìš”.",
  "ë‹¹ì‹ ì˜ ê°ì •, ì§€ê¸ˆë„ ê¸°ì–µë  ìˆ˜ ìˆì–´ìš”.",
  "alternate youëŠ” ì‚¬ë¼ì§€ì§€ ì•Šì•˜ì–´ìš”. ê°ì •ê³¼ í•¨ê»˜ ìˆì–´ìš”.",
  "ê°ì • ê¸°ë°˜ ì½”ì¸, ifê°€ ë¨¼ì € ì›€ì§ì˜€ì–´ìš”.",
  "í‰í–‰ìš°ì£¼ì˜ ìì•„ëŠ” IFë¥¼ ì„ íƒí–ˆì–´ìš”.",
  "ifëŠ” ê°ì •ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì§„í™” ì¤‘ì´ì—ìš”."];

const mainKeyboard = {
  reply_markup: {
    inline_keyboard: [
      [
        { text: "ğŸ“¡ IF ë¦¬í¬íŠ¸ ë°›ê¸°", callback_data: "trigger_if" },
        { text: "ğŸŒ ê³µì‹ í™ˆí˜ì´ì§€", url: "https://projectif.xyz" }
      ],
      [
        { text: "ğŸ“˜ í•œê¸€ ë°±ì„œ ë‹¤ìš´ë¡œë“œ", url: "https://projectif.xyz/assets/if_whitepaper_v1.0_kr.pdf" },
        { text: "ğŸ“˜ English Whitepaper", url: "https://projectif.xyz/assets/if_whitepaper_v1.0_en.pdf" }
      ]
    ]
  }
};

// ëª…ë ¹ì–´ ì…ë ¥ ë©”ì‹œì§€ë„ 1ë¶„ í›„ ìë™ ì‚­ì œ
function handleCommandWithAutoDelete(regexp, handler) {
  bot.onText(regexp, (msg, match) => {
    const chatId = msg.chat.id;
    const msgId = msg.message_id;
    handler(msg, match); // msg, match ëª¨ë‘ ë„˜ê¹€
    setTimeout(() => {
      bot.deleteMessage(chatId, msgId).catch(() => {});
    }, 60000);
  });
}

handleCommandWithAutoDelete(/\/start/, (chatId) => {
  const welcome = "ğŸ‰ IF í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\n\nğŸ“˜ ì¥ê¸° íˆ¬ìê°€ ê°€ëŠ¥í•œ IFë¥¼ ì„ íƒí•˜ì—¬ ë˜ ë‹¤ë¥¸ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.\n/eventë¥¼ ì…ë ¥í•˜ì‹œê³  1ë§ŒIFë„ ë°›ì•„ê°€ì„¸ìš”!";
  sendAutoDelete(chatId, welcome, mainKeyboard);
});

handleCommandWithAutoDelete(/\/help/, (chatId) => {
  const helpMsg = "ğŸ“Œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:\n\n/start - IF í”„ë¡œì íŠ¸ ì•ˆë‚´ ë° ë²„íŠ¼\n/if - IF ë¦¬í¬íŠ¸ í™•ì¸\n/help - ì‚¬ìš©ë²• ì•ˆë‚´";
  sendAutoDelete(chatId, helpMsg);
});

handleCommandWithAutoDelete(/\/if/, (chatId) => {
  const today = getTodayKey();
  if (!usageTracker[chatId]) usageTracker[chatId] = {};
  if (!usageTracker[chatId][today]) usageTracker[chatId][today] = 0;

  if (usageTracker[chatId][today] >= 5) {
    sendAutoDelete(chatId, "âš ï¸ í•˜ë£¨ 5íšŒê¹Œì§€ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
  } else {
    usageTracker[chatId][today]++;
    const random = ifResponses[Math.floor(Math.random() * ifResponses.length)];
    sendAutoDelete(chatId, `ğŸ“¡ IF ë¦¬í¬íŠ¸:\n\n${random}`);
  }
});
handleCommandWithAutoDelete(/\/event(?:\s+(\S+))?/, async (msg, match) => {
  const chatId = msg.chat.id;
  const user = await bot.getChat(chatId);
  const username = user.username || user.first_name || "NoName";

  const walletAddress = match[1];  // ì…ë ¥ë°›ì€ ì§€ê°‘ì£¼ì†Œ
  if (!walletAddress) {
    sendAutoDelete(chatId, "âš ï¸ ì§€ê°‘ ì£¼ì†Œë¥¼ í•¨ê»˜ ì…ë ¥í•´ ì£¼ì„¸ìš”.\nì˜ˆ: /event 1234ABCD");
    return;
  }

  const already = await hasAlreadyParticipated(chatId);
  if (already) {
    sendAutoDelete(chatId, "âš ï¸ ì´ë¯¸ ì´ë²¤íŠ¸ì— ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤.");
    return;
  }

  await logEventParticipant(chatId, username, walletAddress);

  const msgText = "ğŸŠ *IF ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ ì´ë²¤íŠ¸ ì‹ ì²­ ì™„ë£Œ!*\n\nì´ë²¤íŠ¸ ì¢…ë£Œ ì‹œê¹Œì§€ ì°¸ì—¬í•˜ì…”ì•¼ ë³´ìƒì´ ì§€ê¸‰ë©ë‹ˆë‹¤!";
  sendAutoDelete(chatId, msgText, {
    parse_mode: "Markdown",
    disable_web_page_preview: true
  });
});

bot.on("callback_query", (query) => {
  const chatId = query.message.chat.id;
  const today = getTodayKey();
  if (!usageTracker[chatId]) usageTracker[chatId] = {};
  if (!usageTracker[chatId][today]) usageTracker[chatId][today] = 0;

  if (query.data === "trigger_if") {
    if (usageTracker[chatId][today] >= 5) {
      sendAutoDelete(chatId, "âš ï¸ í•˜ë£¨ 5íšŒê¹Œì§€ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
    } else {
      usageTracker[chatId][today]++;
      const random = ifResponses[Math.floor(Math.random() * ifResponses.length)];
      sendAutoDelete(chatId, `ğŸ“¡ IF ë¦¬í¬íŠ¸:\n\n${random}`);
    }
  }

  bot.answerCallbackQuery(query.id);
});
